# QRオーダーシステム設計の課題点

## 1. セッション管理の問題

- **セッションの有効期限管理**  
  店舗ごとに設定できるとされているが、期限切れを検出・処理する仕組みが明確でない。バックグラウンドジョブで定期的にチェックするか、アクセス時に確認するか方針を決める必要がある。

- **セッションの中間状態**  
  会計前にブラウザを閉じた場合や、長時間放置された注文の扱いが不明確。セッションが途中で切れた場合のリカバリー方法や、店舗側での対応フローを設計する必要がある。

- **複数デバイスからの同一テーブルアクセス**  
  同じテーブルIDに複数人が同時にアクセスした場合の動作が不明確。最新の状態を反映する同期メカニズムや、衝突を防ぐロック機能が必要かもしれない。

## 2. データ構造の問題

- **テーブルとセッションの一体管理**  
  テーブルとセッションを同じテーブルで管理する場合、データの整合性維持が難しくなる可能性がある。特にテーブル情報は永続的だが、セッション情報は一時的という性質の違いがある。

- **会計後のデータ保持**  
  会計情報（売上データ）は分析や記録のために保持する必要があるが、セッション情報は破棄するという矛盾がある。どのようにデータを分離・保存するか検討が必要。

- **履歴データの保持方法**  
  会計後も注文履歴をレポートや分析目的で保持したい場合、どのようにアーカイブするか明確でない。

## 3. セキュリティの問題

- **セッションIDの漏洩リスク**  
  クッキーなどでセッションIDを管理する場合、XSS攻撃などによるセッションIDの漏洩リスクがある。HTTPSの強制やSecure属性の設定など、適切な対策が必要。

- **QRコードの再利用対策**  
  古いQRコードが再利用された場合や、不正にコピーされた場合の対策が不足している。QRコードに有効期限を設けるか、一度のみ有効な仕組みを検討すべき。

- **注文改ざん防止**  
  セッションIDのみの認証で、注文内容の改ざんを十分に防げるか検証が必要。金額計算はサーバー側で行うなどの対策が考えられる。

## 4. ユーザビリティの問題

- **エラー時のユーザー体験**  
  セッション無効時や期限切れ時のエラーメッセージや、再接続の手順がユーザーにとって分かりやすいか検討が必要。

- **複数回の注文フロー**  
  同じテーブルから複数回注文する場合の動線が明確でない。既存の注文に追加する形式か、新規注文として扱うかなど。

- **会計後の再注文対応**  
  会計後に追加注文したい場合、新しいセッションを開始する必要があるが、その導線や説明が不足している。

## 5. 運用面の問題

- **デバッグ・トラブルシューティング**  
  セッション情報が会計後に破棄されると、問題追跡が困難になる。一定期間のログ保持やデバッグモードの実装を検討すべき。

- **バックアップとリカバリー**  
  システム障害発生時のデータ復旧方法や、中断された注文の扱いが明確でない。定期的なバックアップ戦略が必要。

- **高負荷時のパフォーマンス**  
  混雑時に多数のテーブルから同時にアクセスがあった場合のパフォーマンス対策や、スケーリング方法が未定義。

## 6. ビジネスロジックの問題

- **注文のキャンセル・変更フロー**  
  注文後の変更やキャンセルが必要になった場合の対応フローが不明確。店舗側の承認プロセスも含めて設計する必要がある。

- **部分会計への対応**  
  テーブルの一部だけ先に会計したい場合（別会計）の対応方法が不明確。同一テーブルで複数セッションを管理する必要があるかもしれない。

- **テーブル移動時の対応**  
  お客様が席を移動する場合、セッションとテーブルIDの紐付けをどう変更するか、そのフローが未定義。
