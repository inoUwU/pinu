# セッションIDとトークンの役割

## トークン

### 役割

トークンは、クライアントとサーバー間で認証や認可を行うために使用されます。特定の操作（例: 注文確定や会計処理）を認証・検証するために利用され、セキュリティを強化する役割を持ちます。

### 特徴

- 一時的で短期間の有効性を持つ。
- クライアント側に保存され、リクエストごとに送信される。
- 主にリクエストの正当性を検証するために使用。
- 再利用や改ざんを防ぐため、暗号化や署名が施されることが多い。

### 保存方法

トークンはクライアント側に保存され（例: ローカルストレージやセッションストレージ）、リクエスト時にサーバーへ送信されます。サーバー側ではトークンの有効性を検証します。

### 有効期間

トークンには短期間の有効期限を設定します。例えば、注文ページが生成されてから15分や30分など、短めの期間を設定することでセキュリティを強化します。有効期限が切れたトークンは無効化され、再生成が必要になります。

---

## セッションID

### 役割

セッションIDは、サーバー側でユーザーの状態を追跡・管理するために使用されます。例えば、ユーザーがどのテーブルで注文を行っているか、どの注文が進行中かなど、状態を一意に識別するためのキーとなります。

### 特徴

- サーバー側で管理される。
- クライアント（ブラウザ）には通常クッキーとして保存される。
- 長期間の状態管理に適している。
- 主にユーザーのセッション全体を識別するために使用。

### 保存方法

セッションIDはサーバー側で管理され、データベースやインメモリストア（例: Redis）に保存されます。保存時には以下の情報を関連付けることが一般的です：

- テーブルID（例: `table_id=T003`）
- ユーザーの注文情報
- セッションの有効期限

### 有効期間

セッションIDには比較的長期間の有効期限を設定します。例えば、注文開始から30分や1時間など、適切な時間を設定します。有効期限が切れたセッションは自動的に削除または無効化されます。

---

## トークンとセッションIDの違い

| 項目           | トークン                              | セッションID                          |
|----------------|--------------------------------------|--------------------------------------|
| **目的**       | リクエストの正当性を検証する          | ユーザーの状態を追跡・管理する         |
| **保存場所**   | クライアント（リクエストに埋め込む）  | サーバー（クライアントにはクッキー）    |
| **有効期間**   | 短期間（例: 数分～15分）              | 比較的長期間（例: 30分～数時間）       |
| **用途**       | 特定の操作やリクエストの認証          | セッション全体の識別                  |
| **セキュリティ**| 改ざん防止や一度きりの利用が重要      | 状態管理が主目的でセキュリティは補助的 |

---

## セキュリティのポイント

1. **HTTPSの利用**: セッションIDやトークンを送受信する際は、必ずHTTPSを使用して通信を暗号化します。
2. **CSRF対策**: トークンを利用して、クロスサイトリクエストフォージェリ（CSRF）攻撃を防ぎます。
3. **トークンの一度きりの利用**: トークンは一度使用されたら無効化することで、リプレイ攻撃を防ぎます。
4. **セッションの自動削除**: 有効期限が切れたセッションやトークンは、定期的にクリーンアップする仕組みを導入します（例: バッチ処理やTTL設定）。
