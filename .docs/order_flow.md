# 注文フロー（セッションID認証のみ）

今回のシステムでは、セッションIDを使用して認証を行います。トークンは使用せず、セッションIDのみで注文の認証を行います。以下はそのフローです。

```mermaid
sequenceDiagram
    participant 顧客 as 顧客（スマホ）
    participant ブラウザ as ブラウザ
    participant サーバー as サーバー
    participant 店舗 as 店舗管理画面

    顧客->>ブラウザ: QRコードを読み取る（URLに table_id=T003）
    ブラウザ->>サーバー: /order?table_id=T003 にアクセス
    サーバー->>サーバー: セッションIDを生成
    サーバー->>サーバー: セッションに table_id, 有効期限 を保存
    サーバー-->>ブラウザ: 注文ページを返却（セッションIDをクッキー等で付与）

    顧客->>ブラウザ: メニューを選択し注文を確定
    ブラウザ->>サーバー: 注文情報 + セッションID を送信
    サーバー->>サーバー: セッションIDを検証
    alt セッション有効かつ有効期限内
        サーバー-->>店舗: 注文情報を通知
        店舗-->>店舗: 注文を処理
        サーバー-->>ブラウザ: 注文完了ページ
    else セッション無効または期限切れ
        サーバー-->>ブラウザ: エラーページを表示
    end

    店舗->>サーバー: 会計ボタン押下（または自動検出）
    サーバー->>サーバー: 該当セッション・注文情報を破棄
    サーバー-->>ブラウザ: 会計完了ページを表示

    note over 顧客,ブラウザ: 会計後、再注文や情報閲覧は不可
```

## 選定理由

注文はステートフルな操作であるためセッションIDを選択。
セッションIDはサーバー側で管理されるため、クライアント側のトークンを扱う必要がなく、セキュリティ上のリスクを軽減できます。

### セッションIDの有効期間について

店舗ごとに異なるため、店舗側で設定できるようにします。例えば、店舗の営業時間や特定のイベントに応じて、セッションIDの有効期限を調整することができます。
